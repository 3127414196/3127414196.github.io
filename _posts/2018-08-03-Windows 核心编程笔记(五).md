---
layout:     post
title:      Windows学习笔记(五)
subtitile:  
date:       2018-08-01
anthor:     Ann
header-img: img/post-bg-ios9-web.jpg
catalog:    true
tags:
    - 消息机制
---

> 在阅读了部分《深入浅出MFC》和与导师讨论以后的总结，后续会继续跟进，由于图片还无法上传，所以在之后之后再加上    


# Win32程序  
> 一个Win32程序主要包括的是窗口的创建+消息的响应处理。  

1. 窗口的创建过程  
> 建立窗口类(`WNDCLASS`)-->注册窗口类(`RegisterClass`)-->创建窗口(`CreateWindow`)-->显示更新窗口(`ShowWindow`,`UpdateWindow`)  
> 在这个过程中，将消息处理的回掉函数`WndProc`与窗口绑定起来  
>> 注：为什需要ShowWindow后还需要UpdateWindow  
>> 因为ShowWindow只负责将窗口以什么各样的方式显示，而UpdateWindow负责发送WM_PAINT消息，将窗口重绘。而不调用UpdateWndow则系统要等消息队列遍历完成之后重绘。同样会显示窗口，只是UpdateWindow会让WM_PAINT立刻被处理发生重绘操作，效率要高一些。

2. 消息响应与处理
> 主要是在WndProc中处理对应的[消息](),在没有单独处理的消息会自动调用默认的消息处理函数。  
> 1. 理解窗口结束的整个过程
> close-->destroy-->quit，所以如果想要一个窗口不关闭，就可以直接对前两个消息不进行任何处理直接返回，这样就无法关闭网页
> 2. 防止窗口结束的方式和对抗
> 广告也采取这样的方式，所以去广告去对抗的话，可以通过接管消息处理函数`SetWindowLong`或者去尝试所有可能的消息值来关闭这个窗口。


# MFC程序  
1. MFC与Win32程序的区别  
> Win32是编程者自己将消息和相应函数联系在一起，但是MFC是直接采用MESSAGE-MAP机制机制来直接处理消息  
> MFC将Win32中的api进行了封装

2. MFC的框架理解(基于多对话框，不涉及View和Doc)
> 由于MFC采用了封装，CWinApp封装了创建窗口(实例化了一个dialog)和消息循环的主流程；一个是CDialogEX，封装了窗口注册、创建、以及消息响应和处理等内容。  
> 这样分类的意义在于，消息处理交给了对应的函数去执行，而CWinApp只需要去控制消息循环和窗口创建和销毁以及窗口间函数信息传递即可。使得逻辑比较清晰


# 一点理解
> 目前使用过的MFC或者是JavaFX都几乎是采用了相同的编程方式，对应每个窗口使用一个类去相对应，类中定义对这个窗口中所有的属性的操作消息完成响应的函数，设置一个入口类，用于控制窗口的生成与销毁，步骤都是类似的。  
> 以下是导师的一些理解  

1、任何UI程序，都是基于窗口的，逃脱不掉消息 + 消息响应处理的基本流程
2、基本上所有的UI程序都是响应式，处理流程一定是针对特定消息，处理某些事件。
3、任何一个引擎框架，一定是基于一个CApp类（管理WinMain等入口函数，以及消息循环的，以及实现InitInstance和ExitInstance），可以把这个类当作整个程序对象，是整个程序运行的流程。
4、任何一个引擎框架，也一定是基于一个主窗口类CWnd类（管理整个窗口的核心部分，包括消息响应等），然后由其他的子窗口、控件等组成，由主的CWnd类，去分发这些消息，给这些子的控件。
5、前面的CApp和CWnd类对象帮助我们处理掉了太多重复性，以及窗口所必须的劳动性工作，剩下的主要任务，是绘制。绘制，就是针对窗口的DC，做一些绘画操作。比如游戏里面，为了能达到最佳效果，游戏引擎在绘制上所做的事情是最多的，包括将绘制过程，抽象成一条流水线，一步步如何把每一个元素，以及元素坐标位置变化计算出来，最终通过DC绘制到屏幕上。所有的引擎所不同的点，就是怎么抽象这个绘制流水线，以及封装成简单易用的绘制对象。
